<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Eye-tracker Omind</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="home.css">

    <style>
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .row {
            display: flex;
            justify-content: center;
            margin: 0 -15px;
        }

        .popup {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.5s;
        }

        .popup h2 {
            margin-top: 0;
            color: #d9534f;
        }

        .popup p {
            text-align: left;
            margin: 15px 0;
        }

        .popup .close-btn {
            background: #d9534f;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Hidden video and canvas elements */
        #video,
        #screenshot {
            display: none;
        }
    </style>
</head>

<body data-spy="scroll" data-target="#navbar">
    <!-- Main content -->
    <section id="home">
        <h1>Bienvenue sur le prototype de Eye-Tracker de Omind Neurotechnologies</h1>
        <div class="container">
            <p class="text-justify">
                WebGazer.js est une bibliothèque Web de suivi du regard qui utilise des webcams courantes pour déduire
                la position du regard de l'utilisateur sur l'écran. Il est conçu pour être facile à utiliser et à
                intégrer dans des applications Web, offrant ainsi aux développeurs un moyen de créer des expériences
                interactives de suivi oculaire sans avoir besoin de matériel spécialisé.
            </p>
            <p class="text-justify">
                La bibliothèque utilise des algorithmes d'apprentissage automatique pour analyser l'entrée vidéo d'une
                webcam et estimer le point sur l'écran où l'utilisateur regarde. Cela peut être utilisé pour diverses
                applications, notamment des études d’utilisateurs, des outils d’accessibilité et des jeux interactifs.
            </p>
            <video id="video" autoplay></video>
            <canvas id="screenshot"></canvas>
        </div>
    </section>

    <section id="examples" class="container pad">
        <h2>Jeux</h2>
        <div class="row">
            <div class="col-lg-4 text-center">
                <h4 class="pad">Luxmeter</h4>
                <p>Outils d'analyse des conditions d'utilisation des du eye tracker.</p>
                <form method="get" action="./luxmeter.html">
                    <button id='calibration_button' class="btn btn-primary" type="submit">Try Live Demo</button>
                </form>
            </div>
            <div class="col-lg-4 text-center">
                <h4 class="pad">Case Game</h4>
                <p>Jeux de reflex visuelle avec un Eye-tracker.</p>
                <form method="get" action="./calibration_case_game.html">
                    <button class="btn btn-primary" type="submit">Try Live Demo</button>
                </form>
            </div>
            <div class="col-lg-4 text-center">
                <h4 class="pad">Emotional game</h4>
                <p>Jeux d'analyse des emotions via des images.</p>
                <form method="get" action="./calibration_emotional_game.html">
                    <button id='calibration_button' class="btn btn-primary" type="submit">Try Live Demo</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Pop-up HTML -->
    <div class="popup-overlay" id="popup">
        <div class="popup">
            <h2>⚠️ Attention ⚠️</h2>
            <p>Conditions d'utilisation:</p>
            <p>1. Retirer les lunettes si possible pour éviter les reflets (interférences entre la caméra et les yeux).
            </p>
            <p>2. Pas à contre-jour, ni lumière directe --> essayer de bien voir les yeux sur la caméra.</p>
            <p>3. Bien utiliser le Luxmeter en premier avant de commencer à jouer à quoi que ce soit.</p>
            <p>4. Bien faire chaque calibration et attendre que la calibration soit finie pour appuyer sur le bouton
                PLAY pour lancer le jeu.</p>
            <p>En cas de problème, veuillez contacter notre support technique.</p>
            <button class="close-btn" onclick="closePopup()">J'ai compris</button>
        </div>
    </div>

    <!-- Pop-up script and additional scripts -->
    <script>
        let screenshotCaptured = false;

        // Function to get browser information
        function getBrowserInfo() {
            const userAgent = navigator.userAgent;
            let browserName = "Unknown Browser";

            if (userAgent.indexOf("Firefox") > -1) {
                browserName = "Mozilla Firefox";
            } else if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) {
                browserName = "Opera";
            } else if (userAgent.indexOf("Chrome") > -1) {
                browserName = "Google Chrome";
            } else if (userAgent.indexOf("Safari") > -1) {
                browserName = "Apple Safari";
            } else if (userAgent.indexOf("MSIE") > -1 || !!document.documentMode === true) {
                browserName = "Microsoft Internet Explorer";
            }

            return browserName;
        }

        // Function to get OS information
        function getOSInfo() {
            const platform = navigator.platform;
            let os = "Unknown OS";

            if (platform.indexOf("Win") > -1) {
                os = "Windows";
            } else if (platform.indexOf("Mac") > -1) {
                os = "MacOS";
            } else if (platform.indexOf("Linux") > -1) {
                os = "Linux";
            } else if (platform.indexOf("Android") > -1) {
                os = "Android";
            } else if (platform.indexOf("iOS") > -1) {
                os = "iOS";
            }

            return os;
        }

        // Function to get camera resolution
        async function getCameraResolution() {
            return navigator.mediaDevices.enumerateDevices()
                .then(devices => {
                    const videoDevices = devices.filter(device => devicekind === 'videoinput');
                    if (videoDevices.length === 0) {
                        throw new Error('No camera found');
                    }
                    return navigator.mediaDevices.getUserMedia({ video: true })
                        .then(stream => {
                            const track = stream.getVideoTracks()[0];
                            const settings = track.getSettings();
                            stream.getTracks().forEach(track => track.stop());
                            return '${ settings.width }x${ settings.height }';
                        });
                })
                .catch(error => {
                    console.error('Error accessing the camera', error);
                    return 'Camera not accessible';
                });
        }

        // Function to log actions and send them to the server


        // Function to show the pop-up
        function showPopup() {
            document.getElementById('popup').classList.add('show');
            logAction('Popup displayed');
        }

        // Function to close the pop-up
        function closePopup() {
            document.getElementById('popup').classList.remove('show');
            logAction('Popup closed');
            if (!screenshotCaptured) {
                captureScreenshot(); // Capture screenshot only if not already captured
                screenshotCaptured = true; // Set flag to true after capturing once
            }
        }

        // Function to capture a screenshot
        function captureScreenshot() {
            const video = document.createElement('video');
            const canvas = document.getElementById('screenshot');
            const context = canvas.getContext('2d');

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    video.onloadedmetadata = () => {
                        video.play();
                        setTimeout(() => {
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            const dataURL = canvas.toDataURL('image/png');

                            // Download the image
                            const link = document.createElement('a');
                            link.href = dataURL;
                            link.download = 'screenshot.png';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);

                            // Stop video stream
                            stream.getTracks().forEach(track => track.stop());
                        }, 1000); // Wait for 1 second to ensure video is ready
                    };
                })
                .catch(error => {
                    console.error('Error accessing the camera', error);
                });
        }

        // Reset screenshotCaptured flag on page refresh
        window.onbeforeunload = () => {
            screenshotCaptured = false;
        };

        // Show popup on page load
        window.onload = () => {
            showPopup();
            // Log browser information
            const browserInfo = getBrowserInfo();
            console.log(`Browser: ${browserInfo}`);

            // Log OS information
            const osInfo = getOSInfo();
            console.log(`OS: ${osInfo}`);

            // Log camera resolution
            getCameraResolution()
                .then(resolution => {
                    console.log(`Camera Resolution: ${resolution}`);
                })
                .catch(error => {
                    console.error('Error getting camera resolution', error);
                });
        };
    </script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>